<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>缴费平台 - 自助缴费</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Noto Sans SC & Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Material Symbols -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <style>
        /* 自定义基础样式 */
        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            -webkit-tap-highlight-color: transparent; /* 移除移动端点击高亮 */
        }
        /* Material Symbols 样式 */
        .material-symbols-outlined {
            font-variation-settings:
            'FILL' 0,
            'wght' 400,
            'GRAD' 0,
            'opsz' 24;
        }
        /* 自定义 checkbox 样式 */
        .custom-checkbox {
            appearance: none;
            -webkit-appearance: none;
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid #cbd5e1; /* gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            display: inline-block;
            position: relative;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .custom-checkbox:checked {
            background-color: #3b82f6; /* blue-500 */
            border-color: #3b82f6; /* blue-500 */
        }
        .custom-checkbox:checked::after {
            content: '✔';
            font-size: 0.875rem;
            color: white;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="app-container" class="max-w-md mx-auto bg-white min-h-screen shadow-lg">

        <!-- Page 1: Payment List -->
        <div id="paymentPage">
            <!-- Header -->
            <header class="sticky top-0 bg-white/80 backdrop-blur-sm z-10">
                <div class="flex items-center justify-between p-4 border-b border-gray-200">
                    <button class="p-2 -ml-2">
                        <span class="material-symbols-outlined text-gray-600">arrow_back_ios_new</span>
                    </button>
                    <h1 class="text-lg font-semibold text-gray-900">学杂费</h1>
                    <div class="w-8"></div> <!-- 占位符，用于居中对齐 -->
                </div>
            </header>

            <!-- Main Content -->
            <main class="p-4 pb-32">
                <h2 class="text-sm font-medium text-gray-500 mb-4">待缴费项目</h2>
                <div id="paymentItems" class="space-y-4">
                    <!-- 缴费项目将由 JS 动态生成 -->
                </div>
            </main>

            <!-- Footer / Payment Bar -->
            <footer class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-200">
                <div class="flex items-center justify-between p-4">
                    <label for="selectAll" class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" id="selectAll" class="custom-checkbox">
                        <span class="text-gray-700">全选</span>
                    </label>
                    <div class="text-right">
                        <p class="text-sm text-gray-600">缴费总额：<span id="totalAmount" class="text-xl font-bold text-red-600">￥0.00</span></p>
                    </div>
                    <button id="goToPayBtn" class="bg-blue-500 text-white font-semibold px-8 py-3 rounded-lg shadow-md hover:bg-blue-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed">
                        去支付
                    </button>
                </div>
            </footer>
        </div>

        <!-- Page 2: Password Input -->
        <div id="passwordPage" class="hidden">
            <!-- Header -->
            <header class="sticky top-0 bg-white/80 backdrop-blur-sm z-10">
                <div class="flex items-center justify-between p-4 border-b border-gray-200">
                    <button id="backToPaymentBtn" class="p-2 -ml-2">
                        <span class="material-symbols-outlined text-gray-600">arrow_back_ios_new</span>
                    </button>
                    <h1 class="text-lg font-semibold text-gray-900">输入支付密码</h1>
                    <div class="w-8"></div>
                </div>
            </header>
            
            <!-- Main Content -->
            <main class="p-8 flex flex-col items-center justify-center mt-12">
                <p class="text-gray-600">请输入6位支付密码</p>
                <div id="passwordDisplay" class="flex space-x-3 my-6">
                    <div class="w-10 h-10 border-b-2 border-gray-400 flex items-center justify-center text-2xl"></div>
                    <div class="w-10 h-10 border-b-2 border-gray-400 flex items-center justify-center text-2xl"></div>
                    <div class="w-10 h-10 border-b-2 border-gray-400 flex items-center justify-center text-2xl"></div>
                    <div class="w-10 h-10 border-b-2 border-gray-400 flex items-center justify-center text-2xl"></div>
                    <div class="w-10 h-10 border-b-2 border-gray-400 flex items-center justify-center text-2xl"></div>
                    <div class="w-10 h-10 border-b-2 border-gray-400 flex items-center justify-center text-2xl"></div>
                </div>
            </main>

            <!-- Numeric Keypad -->
            <div id="keypad" class="grid grid-cols-3 gap-px bg-gray-300 fixed bottom-0 left-0 right-0 max-w-md mx-auto">
                <!-- 数字键盘将由 JS 动态生成 -->
            </div>
        </div>

        <!-- Page 3: Success -->
        <div id="successPage" class="hidden">
            <!-- Header -->
             <header class="sticky top-0 bg-white/80 backdrop-blur-sm z-10">
                <div class="flex items-center justify-between p-4 border-b border-gray-200">
                    <button id="backToHomeBtn" class="p-2 -ml-2">
                        <span class="material-symbols-outlined text-gray-600">arrow_back_ios_new</span>
                    </button>
                    <h1 class="text-lg font-semibold text-gray-900">学杂费</h1>
                    <div class="w-8"></div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="p-8 flex flex-col items-center justify-center text-center mt-20">
                <span class="material-symbols-outlined text-green-500 !text-8xl mb-6">
                    check_circle
                </span>
                <h2 class="text-2xl font-bold text-gray-900 mb-2">支付成功</h2>
                <div class="bg-gray-100 rounded-lg p-6 w-full mt-8 text-left space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">支付金额</span>
                        <span id="successAmount" class="font-bold text-lg text-gray-900"></span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">订单号</span>
                        <span id="orderNumber" class="font-mono text-sm text-gray-700"></span>
                    </div>
                </div>
                 <button id="doneBtn" class="mt-12 w-full bg-blue-500 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-600 transition-colors">
                    完成
                </button>
            </main>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const paymentPage = document.getElementById('paymentPage');
            const passwordPage = document.getElementById('passwordPage');
            const successPage = document.getElementById('successPage');
            
            const paymentItemsContainer = document.getElementById('paymentItems');
            const selectAllCheckbox = document.getElementById('selectAll');
            const totalAmountSpan = document.getElementById('totalAmount');
            const goToPayBtn = document.getElementById('goToPayBtn');

            const passwordDisplay = document.getElementById('passwordDisplay');
            const keypadContainer = document.getElementById('keypad');
            const backToPaymentBtn = document.getElementById('backToPaymentBtn');

            const successAmountSpan = document.getElementById('successAmount');
            const orderNumberSpan = document.getElementById('orderNumber');
            const backToHomeBtn = document.getElementById('backToHomeBtn');
            const doneBtn = document.getElementById('doneBtn');


            // --- Data ---
            const paymentData = [
                { id: 1, name: '2025学年-宿费', standard: 1000.00, paid: 0.00, deferred: 0.00, refund: 0.00, due: 1000.00 },
                { id: 2, name: '2025学年-专业学费', standard: 1750.00, paid: 0.00, deferred: 0.00, refund: 0.00, due: 1750.00 },
                { id: 3, name: '2025学年-学分学费', standard: 2900.00, paid: 0.00, deferred: 0.00, refund: 0.00, due: 1730.00 },
                { id: 4, name: '2025学年-书籍费', standard: 650.00, paid: 0.00, deferred: 0.00, refund: 0.00, due: 650.00 },
                { id: 5, name: '2025学年-空调使用维护费', standard: 80.00, paid: 0.00, deferred: 0.00, refund: 0.00, due: 80.00 },
            ];
            
            let password = '';
            let finalAmount = 0;

            // --- Functions ---
            
            /**
             * 格式化货币
             * @param {number} amount - 金额
             * @returns {string} - 格式化后的字符串 e.g., ￥1,000.00
             */
            const formatCurrency = (amount) => {
                return `￥${amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            };

            /**
             * 渲染缴费项目列表
             */
            const renderPaymentItems = () => {
                paymentItemsContainer.innerHTML = '';
                paymentData.forEach(item => {
                    const itemHtml = `
                        <div class="bg-white border border-gray-200 rounded-lg p-4 flex items-start space-x-4">
                            <input type="checkbox" id="item-${item.id}" class="custom-checkbox mt-1.5 item-checkbox" data-amount="${item.standard}">
                            <div class="flex-1">
                                <label for="item-${item.id}" class="text-base font-bold text-gray-900 cursor-pointer">${item.name}</label>
                                <div class="mt-3 text-sm text-gray-600 space-y-1.5">
                                    <p>收费标准：${formatCurrency(item.standard)}</p>
                                    <p>已交金额：${formatCurrency(item.paid)}</p>
                                    <p>缓交金额：${formatCurrency(item.deferred)}</p>
                                    <p>退费金额：${formatCurrency(item.refund)}</p>
                                    <p class="font-semibold">待缴金额：<span class="text-red-600">${formatCurrency(item.due)}</span></p>
                                </div>
                            </div>
                        </div>
                    `;
                    paymentItemsContainer.innerHTML += itemHtml;
                });
                addItemCheckboxListeners();
            };
            
            /**
             * 更新总金额
             */
            const updateTotal = () => {
                const itemCheckboxes = document.querySelectorAll('.item-checkbox');
                let total = 0;
                itemCheckboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        total += parseFloat(checkbox.dataset.amount);
                    }
                });
                totalAmountSpan.textContent = formatCurrency(total);
                goToPayBtn.disabled = total === 0;
                
                // 更新全选框状态
                const allChecked = Array.from(itemCheckboxes).every(cb => cb.checked);
                const someChecked = Array.from(itemCheckboxes).some(cb => cb.checked);
                selectAllCheckbox.checked = allChecked;
                selectAllCheckbox.indeterminate = !allChecked && someChecked;
            };

            /**
             * 为项目复选框添加事件监听
             */
            const addItemCheckboxListeners = () => {
                document.querySelectorAll('.item-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', updateTotal);
                });
            };

            /**
             * 渲染数字键盘
             */
            const renderKeypad = () => {
                const keys = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '', '0', 'del'];
                keypadContainer.innerHTML = keys.map(key => {
                    if (key === '') {
                        return `<div class="bg-gray-300"></div>`;
                    }
                    if (key === 'del') {
                        return `<button data-key="${key}" class="keypad-btn bg-gray-300 h-16 flex items-center justify-center active:bg-gray-400"><span class="material-symbols-outlined">backspace</span></button>`;
                    }
                    return `<button data-key="${key}" class="keypad-btn bg-white h-16 text-2xl active:bg-gray-100">${key}</button>`;
                }).join('');
                addKeypadListeners();
            };
            
            /**
             * 为键盘按钮添加事件监听
             */
            const addKeypadListeners = () => {
                document.querySelectorAll('.keypad-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        const key = button.dataset.key;
                        if (key === 'del') {
                            password = password.slice(0, -1);
                        } else if (password.length < 6) {
                            password += key;
                        }
                        updatePasswordDisplay();
                        if (password.length === 6) {
                            processPayment();
                        }
                    });
                });
            };

            /**
             * 更新密码输入框显示
             */
            const updatePasswordDisplay = () => {
                const displayDivs = passwordDisplay.children;
                for (let i = 0; i < 6; i++) {
                    if (i < password.length) {
                        displayDivs[i].innerHTML = '<span class="text-3xl -translate-y-1">•</span>';
                    } else {
                        displayDivs[i].innerHTML = '';
                    }
                }
            };

            /**
             * 处理支付逻辑
             */
            const processPayment = () => {
                // 模拟网络延迟
                setTimeout(() => {
                    showPage('success');
                    finalAmount = parseFloat(totalAmountSpan.textContent.replace(/[￥,]/g, ''));
                    successAmountSpan.textContent = formatCurrency(finalAmount);
                    orderNumberSpan.textContent = generateOrderNumber();
                }, 500);
            };
            
            /**
             * 生成订单号
             * @returns {string} - 格式为 YYYYMMDD + 2个字母 + 5个数字
             */
            const generateOrderNumber = () => {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                
                const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                const randomLetters = letters[Math.floor(Math.random() * letters.length)] + letters[Math.floor(Math.random() * letters.length)];
                
                const randomNumbers = String(Math.floor(Math.random() * 90000) + 10000);
                
                return `${year}${month}${day}${randomLetters}${randomNumbers}`;
            };

            /**
             * 切换页面显示
             * @param {'payment' | 'password' | 'success'} pageName - 页面名称
             */
            const showPage = (pageName) => {
                paymentPage.classList.add('hidden');
                passwordPage.classList.add('hidden');
                successPage.classList.add('hidden');

                if (pageName === 'payment') {
                    paymentPage.classList.remove('hidden');
                } else if (pageName === 'password') {
                    passwordPage.classList.remove('hidden');
                    password = '';
                    updatePasswordDisplay();
                } else if (pageName === 'success') {
                    successPage.classList.remove('hidden');
                }
            };
            
            /**
             * 重置到初始状态
             */
            const resetToHome = () => {
                selectAllCheckbox.checked = false;
                document.querySelectorAll('.item-checkbox').forEach(cb => cb.checked = false);
                updateTotal();
                showPage('payment');
            };

            // --- Event Listeners ---
            
            // 全选/取消全选
            selectAllCheckbox.addEventListener('change', () => {
                const isChecked = selectAllCheckbox.checked;
                document.querySelectorAll('.item-checkbox').forEach(checkbox => {
                    checkbox.checked = isChecked;
                });
                updateTotal();
            });

            // 去支付
            goToPayBtn.addEventListener('click', () => {
                if (!goToPayBtn.disabled) {
                    showPage('password');
                }
            });
            
            // 从密码页返回
            backToPaymentBtn.addEventListener('click', () => showPage('payment'));
            
            // 从成功页返回/完成
            backToHomeBtn.addEventListener('click', resetToHome);
            doneBtn.addEventListener('click', resetToHome);

            // --- Initialization ---
            const init = () => {
                renderPaymentItems();
                renderKeypad();
                updateTotal();
                showPage('payment');
            };

            init();
        });
    </script>
</body>
</html>
